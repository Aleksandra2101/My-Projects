<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="cards-page.css" />
  </head>
  <body>
    <div class="cards-page">
      <div class="header" id="name"> Hello </div> 

      <div class="filters-container"> 
        <div class="search-filter-container">
          <input placeholder="Search" id="search" />
          <button onclick="search()">Search</button>
        </div>

        <div class="select-filter-container">
          <select id="sortSelect">
            <option value="ascending">Ascending</option>
            <option value="descending ">Descending</option>
          </select>
          <button onclick="filter()">Sort</button>
        </div>
      </div>

      <div class="loader-container" id="loader">
        <div class="loader"></div>
      </div>

      <div id="cards" class="cards-container"></div>
    </div>
  </body>

  <script>
    function filter() {
      let sortedArray;
      if (document.getElementById("sortSelect").value === "ascending") {
        sortedArray = cardsArray.sort(function (cardA, cardB) {
          if (cardA.name < cardB.name) {
            return -1;
          }
          if (cardA.name > cardB.name) {
            return 1;
          }
          return 0;
        });
      } else {
        sortedArray = cardsArray.sort(function (cardA, cardB) {
          if (cardA.name > cardB.name) {
            return -1;
          }
          if (cardA.name < cardB.name) {
            return 1;
          }
          return 0;
        });
      }

      putCardsInHtml(sortedArray);
    }

    function search() {
      let searchString = document.getElementById("search").value;
      let resultArray = [];
      cardsArray.forEach((card) => {
        if (card.name) {
          if (card.name.includes(searchString)) resultArray.push(card);
        }

        if (card.text) {
          if (card.text.includes(searchString)) resultArray.push(card);
        }
      });

      putCardsInHtml(resultArray);
    }

    const urlParams = new URLSearchParams(window.location.search);
    const myParam = urlParams.get("name");
    document.getElementById("name").innerHTML += myParam;
    let cardsArray;

    // Set up our HTTP request
    var xhr = new XMLHttpRequest();

    // Setup our listener to process completed requests
    xhr.onload = function () {
      // Process our return data
      if (xhr.status >= 200 && xhr.status < 300) {
        // What do when the request is successful
        console.log("success!", xhr);
        document.getElementById("loader").style.display = "none";

        cardsArray = JSON.parse(xhr.response).cards;
        putCardsInHtml(cardsArray);
      }
    };

    xhr.open(
      "GET",
      "https://api.magicthegathering.io/v1/cards?random=true&pageSize=100&language=English"
    );
    xhr.send();

    function putCardsInHtml(cardsArray) {
      document.getElementById("cards").innerHTML = "";

      cardsArray.forEach((card) => {
        document.getElementById("cards").innerHTML +=
          "<div class='card-container'  style='background-color: " +
          card.colors[0] +
          "'>" +
          "<div>" +
          "Name: " +
          card.name +
          " </div>" +
          "<div>" +
          "Type: " +
          card.type +
          " </div>" +
          "<div>" +
          "Text: " +
          card.text +
          " </div>" +
          "<div>" +
          "Set Name: " +
          card.setName +
          " </div>" +
          "</div>";
        // name, type, setName, colors
      });
    }
  </script>
</html>
